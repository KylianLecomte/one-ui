<form (ngSubmit)="onSubmitTask()" [formGroup]="taskForm">
  <fieldset class="card">
    <legend>Création d'une tâche</legend>

    <one-input-text
      [cssClassInput]="['default']"
      formControlName="name"
      id="name"
      label="Nom"
      labelPosition="top"
      placeholder="Nom"
    />
    <one-textarea
      [cssClassInput]="['default']"
      formControlName="description"
      id="description"
      label="Description"
      labelPosition="top"
      placeholder="Description"
    ></one-textarea>

    <one-tabs [formGroup]="frequencyRuleForm">
      <one-tab [label]="Frequency.WEEKLY">
        <ng-template>
          <one-task-frequency-weekly [weeklyForm]="weeklyRule"></one-task-frequency-weekly>
        </ng-template>
      </one-tab>
      <one-tab [label]="Frequency.MONTHLY"><ng-template>MONTHLY</ng-template></one-tab>
      <one-tab [label]="Frequency.FIX"><ng-template>FIX</ng-template></one-tab>

      <div commonContent>
        <div class="ctn-start-frequency flex-row">
          <one-date-picker
            [cssClassInput]="['default']"
            formControlName="startDate"
            id="startDate"
            label="Début"
            labelPosition="left"
          />
        </div>

        <div class="ctn-end-frequency flex-row">
          <one-select
            [cssClassInput]="['default']"
            [options]="END_FREQUENCY"
            formControlName="end"
            id="frequencyEnd"
            label="Fin"
            labelPosition="left"
          ></one-select>

          @if (['date'].includes(endFrequencyValue)) {
            <one-date-picker
              [cssClassInput]="['default']"
              formControlName="endDate"
              id="endDate"
              labelPosition="hidden"
            />
          } @else if (['nbOccurence'].includes(endFrequencyValue)) {
            <one-input-number
              labelPosition="hidden"
              [id]="'nbOccurence'"
              formControlName="endNbOccurence"
              [cssClassInput]="['default']"
            ></one-input-number>
          }
        </div>
        <div class="ctn-btn-add-frequency flex-row">
          <one-button (click)="onAddFrequencyRule()" typeCss="complementary"
            >Ajouter la règle de répétition</one-button
          >
          @if (this.selectedfrequencyRuleIndex() !== null) {
            <one-button (click)="onCancelEditFrequencyRule()">Annuler</one-button>
          }
        </div>
      </div>
    </one-tabs>

    @for (frequencyRule of frequencyRules.controls; track $index) {
      <one-task-frequency-rule
        [isSelected]="selectedfrequencyRuleIndex() === $index"
        [frequencyRule]="formRuleToDomain(frequencyRule.getRawValue())"
        (select)="onEditFrequencyRule($index)"
        (delete)="onDeleteFrequencyRule($index)"
      ></one-task-frequency-rule>
    }

    <one-button type="submit">Ajouter</one-button>
  </fieldset>
</form>
