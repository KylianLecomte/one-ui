<form (ngSubmit)="onSubmitTask()" [formGroup]="taskForm">
  <fieldset class="card">
    <legend>Création d'une tâche</legend>

    <one-input-text
      [cssClassInput]="['default']"
      formControlName="name"
      id="name"
      label="Nom"
      labelPosition="top"
      placeholder="Nom"
    />
    <one-textarea
      [cssClassInput]="['default']"
      formControlName="description"
      id="description"
      label="Description"
      labelPosition="top"
      placeholder="Description"
    ></one-textarea>

    <one-tabs [formGroup]="repetitionRuleForm">
      <one-tab [label]="Repetition.WEEKLY">
        <ng-template>
          <one-task-weekly-repetition [weeklyForm]="weeklyRule"></one-task-weekly-repetition>
        </ng-template>
      </one-tab>
      <one-tab [label]="Repetition.MONTHLY"><ng-template>MONTHLY</ng-template></one-tab>
      <one-tab [label]="Repetition.FIX"><ng-template>FIX</ng-template></one-tab>

      <div commonContent>
        <div class="ctn-start-repetition flex-row">
          <one-date-picker
            [cssClassInput]="['default']"
            formControlName="startDate"
            id="startDate"
            label="Début"
            labelPosition="left"
          />
        </div>

        <div class="ctn-end-repetition flex-row">
          <one-select
            [cssClassInput]="['default']"
            [options]="END_REPETITION"
            formControlName="end"
            id="repetitionEnd"
            label="Fin"
            labelPosition="left"
          ></one-select>

          @if (endRepetitionValue === 'date') {
            <one-date-picker
              [cssClassInput]="['default']"
              formControlName="endDate"
              id="endDate"
              labelPosition="hidden"
            />
          } @else if (endRepetitionValue === 'nbOccurence') {
            <one-input-number
              [cssClassInput]="['default']"
              formControlName="endNbOccurence"
              id="endNbOccurence"
              labelPosition="hidden"
            ></one-input-number>
          }
        </div>
        <div class="ctn-btn-add-repetition flex-row">
          <one-button (click)="onAddRepetitionRule()" typeCss="complementary"
            >Ajouter la règle de répétition</one-button
          >
          @if (this.selectedRepetitionRuleIndex() !== null) {
            <one-button (click)="onCancelEditRepetitionRule()">Annuler</one-button>
          }
        </div>
      </div>
    </one-tabs>

    @for (repetitionRule of repetitionRules.controls; track $index) {
      <one-task-repetition-rule
        [isSelected]="selectedRepetitionRuleIndex() === $index"
        [repetitionRule]="formRuleToDomain(repetitionRule.getRawValue())"
        (select)="onEditRepetitionRule($index)"
        (delete)="onDeleteRepetitionRule($index)"
      ></one-task-repetition-rule>
    }

    <one-button type="submit">Ajouter</one-button>
  </fieldset>
</form>
